<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>vue6_ES2016</title>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.4.0/css/bulma.css">
    <style type="text/css"></style>
    <script type="text/javascript" src='https://unpkg.com/vue@2.2.6/dist/vue.js'></script>
</head>

<body>
    <div id="root" class="container" >
        <coupon @applied="onCouponApplied"></coupon>
        <h1 v-if="visible">You used a coupon!</h1>
    </div>

    <script type="text/javascript">
    window.Event = new class{
        constructor(){
            this.vue = new Vue();
        }

        fire(event, data=null){
            this.vue.$emit(event,data);
        }

        listen(event, callback){
            this.vue.$on(event,callback);
        }
    }


    Vue.component('coupon', {
        template:
        `   
        <input placeholder="Enter your coupon code" @blur="onCouponApplied" /> 
        `,		
        data(){
            return {a:'aaa'}
        },
        methods:{
            onCouponApplied(){
                Event.fire('applied');
            }
        }
    });

    var vm = new Vue({
        el: '#root',
        data:{
            visible:true
        },
        methods:{
            onCouponApplied(x){
                console.log(x);
                this.visible = !this.visible;
            }
        },
        created(){
            Event.listen('applied', ()=> alert('Handling it!'));
        }
    });
    </script>
</body>

</html>
